# ZSAI devices configuration options

# Copyright (c) 2023 Nordic Semiconductor ASA
# SPDX-License-Identifier: Apache-2.0

#
# Zepyr Storage Access Interface
#
config ZSAI_HAS_DRIVER_ENABLED
	bool
	help
	  This option is enabled when any ZSAI enabled device is present in system.

config ZSAI_DEVICE_REQUIRES_ERASE
	bool
	help
	  Device requires erase before write.

config ZSAI_DEVICE_HAS_ERASE
	bool
	default y if ZSAI_DEVICE_REQUIRES_ERASE
	help
	  Device has erase function. It does not mean that erase is required
	  by a device, it just means that it provides erase functionality.

config ZSAI_DEVICE_HAS_NO_ERASE
	bool
	help
	  Device does not require erase.

if ZSAI_DEVICE_REQUIRES_ERASE

config ZSAI_DEVICE_HAS_UNIFORM_PAGES
	bool
	help
	  Device has uniform page layout, all pages are of the same size.

config ZSAI_DEVICE_HAS_NON_UNIFORM_PAGES
	bool
	help
	  Device has non-uniform page layout, sizes of pages are different.

config ZSAI_DEVICE_HAS_PAGE_HOLES
	bool
	help
	  Device has non linear address space where non-accessible areas appear
	  between accessible pages.

config ZSAI_DEVICE_ERASES_TO_1
	bool
	help
	  Device erase bit value is 1, so byte erases to 0xff and so on.

config ZSAI_DEVICE_ERASES_TO_0
	bool
	help
	  Device erase bit value is 0, so byte erases to 0x00 and so on.

endif # ZSAI_DEVICE_REQUIRES_ERASE

menuconfig ZSAI
	bool "Zephyr Storage Access Interface"
	default n if !DT_HAS_ZEPHYR_ZSAI_SIMULATOR_ENABLED
	help
	  Enable support for various devices that can be used for code and data storage

if ZSAI

module = ZSAI
module-str = zsai
source "subsys/logging/Kconfig.template.log_config"

config ZSAI_INIT_PRIORITY
	int "Zephyr Storage Access Interface init priority"
	default KERNEL_INIT_PRIORITY_DEVICE
	help
	  Default priority for ZSAI device drivers initialization. Driver may provide own
	  initialization priority konfiguration option.

config ZSAI_INIT_PRIORITY
	int "Zephyr Storage Access Interface init priority"
	default KERNEL_INIT_PRIORITY_DEVICE
	help
	  Default priority for ZSAI device drivers initialization. Driver may provide own
	  initialization priority konfiguration option.

if DT_HAS_ZEPHYR_ZSAI_SIMULATOR_ENABLED

config ZSAI_SIMULATED_DEVICE_WITH_ERASE
	bool
	def_bool $(dt_any_compat_enabled_with_prop,$(DT_COMPAT_ZEPHYR_ZSAI_SIMULATOR),erase-value)
	help
	  There is simulated device defined with erase required.

config ZSAI_SIMULATED_DEVICE_WITHOUT_ERASE
	bool
	def_bool $(dt_any_compat_enabled_without_prop,$(DT_COMPAT_ZEPHYR_ZSAI_SIMULATOR),erase-value)
	help
	  There is simulated device without erase defined.

if ZSAI_SIMULATED_DEVICE_WITH_ERASE

config ZSAI_SIMULATED_DEVICE_WITH_ERASE_TO_1
	bool
	def_bool $(dt_any_compat_enabled_with_prop,$(DT_COMPAT_ZEPHYR_ZSAI_SIMULATOR),erase-value,0xff)
	help
	  There is simulated device that erases to 1 (0xff in byte).

config ZSAI_SIMULATED_DEVICE_WITH_ERASE_TO_0
	bool
	def_bool $(dt_any_compat_enabled_with_prop,$(DT_COMPAT_ZEPHYR_ZSAI_SIMULATOR),erase-value,0x00)
	help
	  There is simulated device that erases to 0 (0x00 in byte).

endif

config ZSAI_SIMULATED_DEVICE_DRIVER
	bool "Add simulated device driver"
	select ZSAI_HAS_DRIVER_ENABLED
	select ZSAI_DEVICE_REQUIRES_ERASE if ZSAI_SIMULATED_DEVICE_WITH_ERASE
	select ZSAI_DEVICE_HAS_NO_ERASE if ZSAI_SIMULATED_DEVICE_WITHOUT_ERASE
	select ZSAI_DEVICE_ERASES_TO_0 if ZSAI_SIMULATED_DEVICE_WITH_ERASE_TO_0
	select ZSAI_DEVICE_ERASES_TO_1 if ZSAI_SIMULATED_DEVICE_WITH_ERASE_TO_1
	help
	  Enabled driver for ZSAI device simulator. The driver covers flash and non-flash
	  device simulation.

if ZSAI_SIMULATED_DEVICE_DRIVER

module = ZSAI_SIM
module-str = zsai_sim
source "subsys/logging/Kconfig.template.log_config"

endif # ZSAI_SIMULATED_DEVICE_DRIVER

endif # DT_HAS_ZEPHYR_ZSAI_SIMULATOR_ENABLED

endif # ZSAI
